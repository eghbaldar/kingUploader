@{
    ViewData["Title"] = "Home Page";
}
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
    .progress {
        margin: 10px;
        width: 100%;
        height: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #dynamic {
        width: 100%;
        height: 100px;
        font-size: 30px;
        font-weight: bold;
    }

    .progress-bar.active, .progress.active .progress-bar {
        -webkit-animation: progress-bar-stripes 2s linear infinite;
        -o-animation: progress-bar-stripes 2s linear infinite;
        animation: progress-bar-stripes 2s linear infinite;
    }

    .progress-bar-success {
        background-color: orange !important;
    }

    .progress-bar-success-gray {
        background-color: gray !important;
    }
</style>

<div class="progress">
    <div id="dynamic" class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
        <span id="current-progress"></span>
    </div>
</div>
<button type="button" onclick="actionProgressbar()">go</button>
@*each byte*@
<div class="w3-border">
    <div class="w3-grey" id="myBar" style="height:24px;width:0%"></div>
</div>

<hr />

<input type="file" id="fileupload1">
<button type="button" onclick="merging()">Merge</button>
<button type="button" id="btncontinue_or_pause_client" onclick="pause()">Pause</button>


@section Scripts{
    <script>

        const eachCHUNK = 100; // (KB) // the volume of each chunk for uploading // NOTE: the last part may less than 100kb
        var start = 0; // first Byte of your file // this varibale will be increase by [chunkSize]
        var chunkSize; // (BYTE) // keep the volume of each chunk in BYTE (eachCHUNK * 1024)
        var file; // Your file
        var continue_or_pause_client; // TRUE: Resuming | False : was Paused
        var subProgressValue = 0; // subProgress Global Variable
        var allowSubProgressValue; // subProgress Global Variable
        var increased_value; // main Progress Global Variable
        var current_progress = 0;// main Progress Global Variable
        const fileInput = document.getElementById('fileupload1');
        fileInput.addEventListener('change', handleFileUpload);

        function handleFileUpload(event) {

            continue_or_pause_client = true; // set default value
            file = event.target.files[0]; // get first file from the [input file]
            chunkSize = 1024 * eachCHUNK; // size of each chunk (1MB)
            CalcIncreaseValue(file.size); // [increased value] to progress of progressbar
            var chunk = file.slice(start, start + chunkSize);
            allowSubProgressValue = true; // SubProgressbar is ready now!
            actionSubProgressbar(); // SubProgressbar is fired!
            uploadChunk(chunk, chunkSize, file.name); // the main function is fired!
            actionProgressbar(true); // the main Progressbar is started!
        }

        // main function
        function uploadChunk(chunk, chunkSize, filename) {

            if (continue_or_pause_client) {
                var postData = new FormData();
                postData.append("file", chunk);
                postData.append("ChunkSize", chunkSize);
                postData.append("Filename", filename);

                $.ajax({
                    contentType: false,
                    processData: false,
                    type: 'POST',
                    data: postData,
                    url: 'Home/Upload',
                    success: function (data) {
                        if (data.success) {
                            start += chunkSize;
                            var chunk2 = file.slice(start, start + chunkSize);
                            if (chunk2.size >= chunkSize) {
                                subProgressValue = 0;
                                actionProgressbar(true);
                            }
                            else
                                actionProgressbar(false); // if the last part is less than [eachCHUNK]KB
                            if (start < file.size)
                                uploadChunk(chunk2, chunkSize, file.name);
                        }
                    },
                    error: function (request, status, error) {
                        //alert('request:' + request.responseText + ';err:' + error);
                    }
                });
            }
        }

        // pausing
        function pause() {
            continue_or_pause_client = !continue_or_pause_client;
            if (!continue_or_pause_client) {
                $("#dynamic").removeClass("progress-bar-success");
                $("#dynamic").addClass("progress-bar-success-gray");
                $("#btncontinue_or_pause_client").html('Resume');
            }
            else {
                $("#btncontinue_or_pause_client").html('Pause');
                $("#dynamic").removeClass("progress-bar-success-gray");
                $("#dynamic").addClass("progress-bar-success");
                var chunk = file.slice(start, start + chunkSize);

                uploadChunk(chunk, chunkSize, file.name);
            }
        }

        // Merging
        function merging() {
            $.ajax({
                contentType: false,
                processData: false,
                type: 'POST',
                url: 'Home/Merge',
                success: function () {
                    //alert('1');
                },
                error: function (request, status, error) {
                    //alert('request:' + request.responseText + ';err:' + error);
                }
            });
        }

        // main progressbar
        function actionProgressbar(lastPartState) {
            if (lastPartState) {
                current_progress += increased_value;
                var showedValue = parseFloat(current_progress.toFixed(2))
                $("#dynamic")
                    .css("width", current_progress + "%")
                    .attr("aria-valuenow", current_progress)
                    .text(showedValue + "%");
            }
            else {
                $("#dynamic")
                    .css("width", 100 + "%")
                    .attr("aria-valuenow", 100)
                    .text(100 + "%");
                allowSubProgressValue = false;
                $("#btncontinue_or_pause_client").css('visibility', 'hidden'); // Hide [pause-continue botton] after being completed the upload process (100%)
            }
        }

        function CalcIncreaseValue(fileSize) {
            //fileSize is BYTE
            var kb = fileSize / 1024;
            var eachKb = Math.ceil(kb / eachCHUNK);
            var eachUnit = 100 / eachKb;
            increased_value = eachUnit;
        }

        // main Sub Progressbar
        function actionSubProgressbar() {
            var elem = document.getElementById("myBar");
            var id = setInterval(frame, 5);
            function frame() {
                if (allowSubProgressValue) {
                    if (subProgressValue >= 100) {
                        clearInterval(id);
                        subProgressValue = 0;
                        actionSubProgressbar();
                    } else {
                        subProgressValue++;
                        elem.style.width = subProgressValue + '%';
                        elem.innerHTML = 'Speed of uploading ...';
                    }
                } else {
                    elem.style.width = 0 + '%';
                    elem.innerHTML = '';
                }
            }
        }

    </script>

}

